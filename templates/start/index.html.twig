<!DOCTYPE html>
<html>
<head>
    <title>{{ room.name }}</title>
</head>
<body style="margin: 0" >


<div id="jitsiWrapper">
    <div class="w-100" id="jitsiWindow">

    </div>
</div>
</body>
{% if name is defined and name is not null %}
    <script>

        if({{ room.server.corsHeader }}){
            window.location.replace("{{ urlFromRoom(user,room, name,'b') }}");
        }
    </script>

    <script src='https://{{ room.server.url }}/external_api.js'></script>
    <script>
        var avatarUrl = '{% if app.user and app.user.profilePicture %}{{ vich_uploader_asset(app.user.profilePicture,'documentFile') }}{% endif %}';
        var setTileview = {{ laf_set_tileview }};
        const domain = '{{ room.server.url }}';
        const options = {
            roomName: '{{ room.uid }}',
            width: '100%',
            height: 700,
            parentNode: document.querySelector('#jitsiWindow'),
            {% if room.server.appId is not null %}
            jwt: '{{ jwtFromRoom(user,room,name) }}',
        {% endif %}
            userInfo: {
                displayName: '{{ name }}',
                {% if user is not null and  user.profilePicture is not null %}
                avatarUrl:'{{ vich_uploader_asset(user.profilePicture,'documentFile') }}',
                {% endif %}
            }
        };
        var conferenzeName = '{{ room.name }}';
        var topic = {{ mercure(absolute_url(path('lobby_moderator',{'uid':room.uidReal})))|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw }};
        var topicBroadcast = {{ mercure(absolute_url(path('lobby_broadcast_websocket',{'roomUid':room.uidReal})))|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw }};

        api = new JitsiMeetExternalAPI(domain, options);

        api.addListener('videoConferenceJoined', function (e) {
            if(setTileview === 1){
                api.executeCommand('setTileView', {enabled:true});
            }
            if(avatarUrl !== ''){
                api.executeCommand('avatarUrl',avatarUrl);
            }
        })
        var iframe = document.querySelector('#jitsiConferenceFrame0');
        iframe.style.height = '100vh';
    </script>

{% endif %}

</html>