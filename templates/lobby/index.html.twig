{% extends 'join/base_fluid.html.twig' %}
{% block header %}
    <h1 class="h1-responsive text-center" >{% trans with {'{name}':room.name} %}lobby.moderator.title{% endtrans %}</h1>
{% endblock %}
{% block content %}
    <div class="col-12">
        <div id="jitsiWrapper">
            <div class="w-100" id="jitsiWindow">

            </div>
            <div class="row lobbyWindow">
                <div class="col-lg-3 col-md-6" id="colWebcam">
                    <div class="card webcamArea">
                        <video autoplay="true" id="lobbyWebcam"></video>
                        <div class="webcamToolbar">
                            <i class="fa fa-video" id="webcamSwitch"></i>
                            {{ app.user.formatedName(laf_showNameInConference) }}
                            {% if app.user == room.moderator %}
                                <i class="fa fa-star"></i>
                            {% endif %}
                        </div>

                    </div>
                    <a class="caretdown btn btn-primary dropdown-toggle" type="button"
                       id="selectWebcamDropdown"
                       data-toggle="dropdown" aria-haspopup="true"
                       aria-expanded="false">{{ 'lobby.noWebCamFound'|trans }}
                    </a>
                    <ul class="dropdown-menu p-1" aria-labelledby="dropdownMenu1" id="webcamSelect">
                    </ul>


                    <div class="btn-group">
                        <a href="#" type="button" class="btn btn-primary" id="startEcho" data-texton="{{ 'lobby.start.echo'|trans }}" data-textoff="{{ 'lobby.stop.echo'|trans }}">{{ 'lobby.start.echo'|trans }}</a>
                        <a href="#" type="button" class="btn btn-primary dropdown-toggle caretdown px-3" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                           <i class="fas fa-microphone"></i>
                        </a>
                        <div class="dropdown-menu" >
                            <div id="audioInputSelect">
                                <a href="#" class="dropdown-item"><b>{{ 'lobby.echo.input'|trans }}</b></a>
                            </div>

                            <div class="dropdown-divider"></div>
                            <div id="audioOutputSelect">
                            <a href="#"  class="dropdown-item"><b>{{ 'lobby.echo.output'|trans }}</b></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-9 col-md-6" id="col-waitinglist">
                    <div id="waitingUserWrapper">
                        <div id="waitingUser" class="row w-100 mb-3">
                            {% for wU in room.lobbyWaitungUsers %}
                                <div class="col-lg-3 col-md-6 waitingUserCard">
                                    <div class="card ">
                                        <div class="card-body text-center d-flex flex-column align-items-center">
                                            <div class="initialCircle ">
                                                {% if wU.user.firstName != '' %}{{ wU.user.firstName[:1] }}{{ wU.user.lastName[:1] }}{% else %}{{ wU.user.username[:1] }}{% endif %}</div>
                                            <div class="participantsName">{{ wU.user.formatedName(laf_showNameInConference) }}</div>

                                        </div>
                                        <div class="card-footer text-center">
                                            <a class="btn-floating btn-sm senddirect" href="{{ path('lobby_moderator_accept',{'wUid':wU.uid}) }}">
                                                <i class="fas fa-user-check "></i>
                                            </a>
                                            <a class="btn-floating btn-sm senddirect" href="{{ path('lobby_moderator_decline',{'wUid':wU.uid}) }}">
                                                <i class="fas fa-user-times "></i>
                                            </a>

                                        </div>

                                    </div>

                                </div>
                            {% endfor %}
                        </div>

                    </div>

                    {% if type == 'a' %}
                        <div class="d-none d-lg-block ">
                            <a class="btn btn-primary"
                               href="{{ path('lobby_moderator_start',{'t':'a','room':room.uidReal}) }}" target="_blank">{{ 'jitsi.start'|trans }}</a>
                        </div>
                    {% elseif type == 'b' %}
                        <div class="d-none d-lg-block ">
                            <a class="btn btn-primary startIframe"
                               href="{{ path('lobby_moderator_start',{'t':'b','room':room.uidReal}) }}" target="_blank">{{ 'jitsi.start'|trans }}</a>
                        </div>
                    {% endif %}

                    <div class="d-block d-lg-none">
                        <a class="btn btn-primary"
                           href="{{ path('lobby_moderator_start',{'t':'b','room':room.uidReal}) }}"
                           target="_blank">{{ 'jitsi.start'|trans }}</a>
                    </div>
                    <a class="btn btn-outline-primary directSend" href="{{ path('lobby_moderator_accept_all',{'roomId':room.uidReal}) }}">{{ 'lobby.allowAllUsers'|trans }}</a>
                </div>

            </div>

        </div>
    </div>





{% endblock %}
{% block script %}
    <script src='https://{{ room.server.url }}/external_api.js'></script>
    <script>
        const domain = '{{ room.server.url }}';
        const options = {
            roomName: '{{ room.uid }}',
            width: '100%',
            height: 700,
            parentNode: document.querySelector('#jitsiWindow'),
            jwt: '{{ jwtFromRoom(app.user,room) }}'
        };

        var conferenzeName = '{{ room.name }}';
        var topic = {{ mercure(absolute_url(path('lobby_moderator',{'uid':room.uidReal})))|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw }};
        var topicBroadcast = {{ mercure(absolute_url(path('lobby_broadcast_websocket',{'roomUid':room.uidReal})))|json_encode(constant('JSON_UNESCAPED_SLASHES') b-or constant('JSON_HEX_TAG'))|raw }};

    </script>

{% endblock %}
{% block webpack %}

    {{ encore_entry_script_tags('lobbyModerator') }}
{% endblock %}
