<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerName <domain.com>
        ServerAdmin webmaster@domain.com

        ErrorLog ${APACHE_LOG_DIR}/jitsiadmin.log
        CustomLog ${APACHE_LOG_DIR}/jitsiadmin.log combined


        <FilesMatch \.php$>
                SetHandler "proxy:unix:/var/run/php8.2-fpm-jitsiadmin.sock|fcgi://localhost"
        </FilesMatch>

        DocumentRoot /var/www/jitsi-admin/current/public
        <Directory /var/www/jitsi-admin/current/public/>
                AllowOverride All
                Order Allow,Deny
                Allow from All
        </Directory>

        ProxyPass /ws/ http://127.0.0.1:3000/ws/

        RewriteEngine on

	RewriteCond %{HTTP:Upgrade} websocket [NC]
	RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/(.*) "ws://127.0.0.1:3000/$1" [P,L]


        ProxyPass /healthz http://127.0.0.1:3000/healthz
        ProxyPassReverse /healthz http://127.0.0.1:3000/healthz


Include /etc/letsencrypt/options-ssl-apache.conf
SSLCertificateFile /etc/letsencrypt/live/pathtocertFile/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/pathToKeyFile/privkey.pem
</VirtualHost>
</IfModule>
